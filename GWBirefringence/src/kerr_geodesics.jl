"""
    pi0(psi::Float64, rho::Float64, geometry::GWBirefringence.geometry)

Calculate the initial covectors ``p_i``.

# Arguments
- `psi::Float64`: the initial direction polar angle
- `rho::Float64`: the initial direction azimuthal angle
- `geometry::GWBirefringence.geometry`: system geometry
"""
function pi0(psi::Float, rho::Float, geometry::GWBirefringence.geometry)
    ψ = psi
    ρ = rho
    @unpack r, theta = geometry.source
    θ = theta
    a = geometry.params.a
    s_θ, c_θ = sin(θ), cos(θ)
    [sqrt((a.^2 .*c_θ.^2 + r.^2) ./(a.^2 + r .*(r - 2))) .*sin(ρ) .*sin(ψ), sqrt(a.^2 .*c_θ.^2 + r.^2) .*sin(ψ) .*cos(ρ), s_θ .*(-a .*s_θ .*sqrt((a.^2 + r .*(r - 2)) ./(a.^2 .*c_θ.^2 + r.^2)) + (a.^2 + r.^2) .*cos(ψ) ./sqrt(a.^2 .*c_θ.^2 + r.^2))]
end


"""
    pt_null(x::Vector{Float64}, geometry::GWBirefringence.geometry)

Calculate the time covector from the null condition.
"""
function pt_null(x::Vector, geometry::GWBirefringence.geometry)
    t, r, θ, ϕ, p_r, p_θ, p_ϕ = x
    @unpack a, ϵ, s = geometry.params
    s_θ, c_θ, c_2θ = sin(θ), cos(θ), cos(2.0*θ)
    (-4*a .*p_ϕ .*r - 2*sqrt(4*a.^2 .*p_ϕ.^2 .*r.^2 + (p_r.^2 .*(a.^2 + r.^2 - 2*r).^2 + p_θ.^2 .*(a.^2 + r.^2 - 2*r) + p_ϕ.^2 .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./s_θ.^2) .*(a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3)/2 + 2*a.^2 .*r .*s_θ.^2 + r.^4))) ./(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4)
end


"""
    time_killing_conservation(x::Vector{Float64}, geometry::GWBirefringence.geometry)

Calculate the time isometry.
"""
function time_killing_conservation(x::Vector, geometry::GWBirefringence.geometry)
    t, r, θ, ϕ, p_r, p_θ, p_ϕ = x
    @unpack a, ϵ, s = geometry.params
    c_θ = cos(θ)
    p_t = pt_null(x, geometry)
   -2*a .*c_θ .*p_r .*r .*s .*ϵ .*(a.^2 + r .*(r - 2)) ./((a .*p_ϕ + p_t .*(a.^2 + r.^2)) .*(a.^2 .*c_θ.^2 + r.^2).^2) + p_t
end


"""
    isometry_residuals!(resid::Vector, x::Vector, p::Vector, tau::Float64,
                        geometry::GWBirefringence.geometry,
                        time_isometry::Float64, phi_isometry::Float64)

Calculate the time and phi isometry residuals.
"""
function isometry_residuals!(resid::Vector, x::Vector, p::Vector, tau::Float64,
                             geometry::GWBirefringence.geometry,
                             time_isometry::Float64, phi_isometry::Float64)
    resid[1] = time_killing_conservation(x, geometry) - time_isometry
    resid[2] = 0.0
    resid[3] = 0.0
    resid[4] = phi_killing_conservation(x, geometry) - phi_isometry
    resid[5] = 0.0
    resid[6] = 0.0
    resid[7] = 0.0
    return resid
end


"""
    phi_killing_conservation(x::Vector{Float64}, geometry::GWBirefringence.geometry)

Calculate the azimuthal, phi isometry.
"""
function phi_killing_conservation(x::Vector, geometry::GWBirefringence.geometry)
    t, r, θ, ϕ, p_r, p_θ, p_ϕ = x
    @unpack a, ϵ, s = geometry.params
    c_θ, c_2θ = cos(θ), cos(2.0*θ)
    s_θ = sin(θ)
    p_t = pt_null(x, geometry)
   (4*c_θ .*p_r .*s .*ϵ .*(a.^2 + r .*(r - 2)) .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4) + (4*a.^2 .*c_θ.^2 + 4*r.^2) .*(2*a .*p_ϕ.^2 .*(a.^2 .*c_θ.^2 + r.^2) + 2*p_t .*p_ϕ .*(a.^2 + r.^2) .*(a.^2 .*c_θ.^2 + r.^2) - 2*p_θ .*r .*s .*s_θ .*ϵ .*(a.^2 + r .*(r - 2)))) ./((8*a .*p_ϕ + 8*p_t .*(a.^2 + r.^2)) .*(a.^2 .*c_θ.^2 + r.^2).^2)
end


"""
    geodesic_odes!(dx::Vector{Float64}, x::Vector{Float64}, geometry::GWBirefringence.geometry)

Calculate the derivatives of ``x_μ`` and ``p_i`` with respect to
the proper time, returned in this order. Expresssions are exported from
Mathematica.
"""
function geodesic_odes!(dx::Vector, x::Vector, geometry::GWBirefringence.geometry)
    t, r, θ, ϕ, p_r, p_θ, p_ϕ = x

    # Unpack the struct
    @unpack a, ϵ, s = geometry.params

    s_θ, c_θ = sin(θ), cos(θ)
    s_2θ, c_2θ = sin(2.0*θ), cos(2.0*θ)
    t_θ, t_2θ = tan(θ), tan(2.0*θ)
    p_t = pt_null(x, geometry)

    dx[1] = a .*s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*c_θ .*p_r .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) .*(a.^2 + r.^2 - 2*r) + p_θ .*s_θ .*(a.^2 .*c_θ.^2 + r.^2) .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) ./(2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3) + (-2*a .*p_ϕ .*r - p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4)/2) ./((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r))

    dx[2] = a .*s .*ϵ .*((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)).^(3/2) .*(-8*c_θ .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) + 16*p_r .*p_θ .*r .*s_θ.^3 .*(a.^2 + r.^2 - 2*r) - 8*p_θ.^2 .*s_2θ .*s_θ .*(a.^2 + r.^2 - 2*r)) ./(16*s_θ.^2 .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4) + p_r .*(a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)

    dx[3] = p_θ ./(a.^2 .*c_θ.^2 + r.^2) + s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(2*a.^3 .*p_r .*s_θ.^2 .*(-c_θ .*p_θ + p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 + 2*a .*p_r .*(a.^2 + r.^2) .*(c_θ .*p_θ - p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 - s_θ .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) ./(2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4)

    dx[4] = s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*p_ϕ .*(2*p_r .*(a.^2 + r.^2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./t_θ + p_θ .*(2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2)) + 2*p_t .*(-a.^2 .*p_r .*r .*s_2θ .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 - r.^2) .*(a.^2 .*c_θ.^2 + r.^2))) ./(2*s_θ .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3) + (-2*a .*p_t .*r + p_ϕ .*(a.^2 ./t_θ.^2 + r.^2 ./s_θ.^2 - 2*r ./s_θ.^2)) ./((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r))

    dx[5] = 2*a .*c_θ .*p_r .*s .*ϵ .*(a.^2 .*c_θ.^2 - 3*r.^2) ./(a.^2 .*c_θ.^2 + r.^2).^3 + sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(-8*a.^2 .*p_r .*s_2θ .*(2*p_θ .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3 + s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(2*a.^3 .*p_r .*s_θ.^2 .*(-c_θ .*p_θ + p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 + 2*a .*p_r .*(a.^2 + r.^2) .*(c_θ .*p_θ - p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 - s_θ .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2)))) .*(a.^2 + r.^2 - 2*r).^2 + a.^2 .*p_θ .*s_2θ .*(-8*a .*s .*ϵ .*((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)).^(3/2) .*(c_θ .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) - 2*p_r .*p_θ .*r .*s_θ.^3 .*(a.^2 + r.^2 - 2*r) + p_θ.^2 .*s_2θ .*s_θ .*(a.^2 + r.^2 - 2*r)) ./s_θ.^2 + 16*p_r .*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4) .*(a.^2 + r.^2 - 2*r) - 8*a .*p_t .*s_θ.^2 .*(-s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*p_ϕ .*(2*p_r .*(a.^2 + r.^2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./t_θ + p_θ .*(2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2)) + 2*p_t .*(-a.^2 .*p_r .*r .*s_2θ .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 - r.^2) .*(a.^2 .*c_θ.^2 + r.^2))) .*(a.^2 + r.^2 - 2*r) ./s_θ + 2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(2*a .*p_t .*r - p_ϕ .*(a.^2 ./t_θ.^2 + r.^2 ./s_θ.^2 - 2*r ./s_θ.^2))) .*(2*a.^4 .*c_θ.^2 - a.^2 .*r.^2 .*(c_2θ + 3) - 6*r.^4) + 16*a .*p_ϕ .*(a.^2 .*c_θ.^2 - r.^2) .*(-a .*s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*c_θ .*p_r .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) .*(a.^2 + r.^2 - 2*r) + p_θ .*s_θ .*(a.^2 .*c_θ.^2 + r.^2) .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) .*(a.^2 + r.^2 - 2*r) + sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4))) + p_r .*(-8*a .*s .*ϵ .*((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)).^(3/2) .*(c_θ .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) - 2*p_r .*p_θ .*r .*s_θ.^3 .*(a.^2 + r.^2 - 2*r) + p_θ.^2 .*s_2θ .*s_θ .*(a.^2 + r.^2 - 2*r)) ./s_θ.^2 + 16*p_r .*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4) .*(a.^2 + r.^2 - 2*r) .*(2*a.^2 .*c_θ.^2 + 2*a.^2 .*r .*s_θ.^2 - 2*r.^2) + 16*p_t .*(a.^2 + r.^2) .*(a.^2 .*c_θ.^2 - r.^2) .*(-a .*s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*c_θ .*p_r .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) .*(a.^2 + r.^2 - 2*r) + p_θ .*s_θ .*(a.^2 .*c_θ.^2 + r.^2) .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) .*(a.^2 + r.^2 - 2*r) + sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4))) + 16*p_θ .*r .*(2*p_θ .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3 + s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(2*a.^3 .*p_r .*s_θ.^2 .*(-c_θ .*p_θ + p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 + 2*a .*p_r .*(a.^2 + r.^2) .*(c_θ .*p_θ - p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 - s_θ .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2)))) .*(a.^2 + r.^2 - 2*r).^2 - 2*p_ϕ .*(-s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*p_ϕ .*(2*p_r .*(a.^2 + r.^2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./t_θ + p_θ .*(2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2)) + 2*p_t .*(-a.^2 .*p_r .*r .*s_2θ .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 - r.^2) .*(a.^2 .*c_θ.^2 + r.^2))) .*(a.^2 + r.^2 - 2*r) ./s_θ + 2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(2*a .*p_t .*r - p_ϕ .*(a.^2 ./t_θ.^2 + r.^2 ./s_θ.^2 - 2*r ./s_θ.^2))) .*(8*a.^4 .*c_θ.^4 .*r + 2*a.^4 .*s_2θ.^2 + 16*a.^2 .*c_θ.^2 .*r.^3 - 4*a.^2 .*r.^2 .*(c_2θ + 3) + 8*r.^5 - 16*r.^4)) ./(32*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4 .*(a.^2 + r.^2 - 2*r).^3)

    dx[6] = -s .*s_θ .*ϵ .*(a .*p_t .*(3*p_r .*r .*(-3*a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 + r.^2) .*(a.^2 .*c_θ.^2 - 3*r.^2) ./t_θ) + p_ϕ .*(a.^2 .*p_θ .*(a.^2 .*c_θ.^2 - 3*r.^2) ./t_θ + 3*p_r .*r .*(-3*a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r) ./s_θ.^2)) ./((a .*p_ϕ + p_t .*(a.^2 + r.^2)) .*(a.^2 .*c_θ.^2 + r.^2).^3) + (-32*a.^3 .*c_θ .*p_t .*r .*s_θ.^3 .*(-s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*p_ϕ .*(2*p_r .*(a.^2 + r.^2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./t_θ + p_θ .*(2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2)) + 2*p_t .*(-a.^2 .*p_r .*r .*s_2θ .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 - r.^2) .*(a.^2 .*c_θ.^2 + r.^2))) .*(a.^2 + r.^2 - 2*r) ./s_θ + 2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(2*a .*p_t .*r - p_ϕ .*(a.^2 ./t_θ.^2 + r.^2 ./s_θ.^2 - 2*r ./s_θ.^2))) - a.^2 .*p_r .*s_2θ .*(-8*a .*s .*ϵ .*((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)).^(3/2) .*(c_θ .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) - 2*p_r .*p_θ .*r .*s_θ.^3 .*(a.^2 + r.^2 - 2*r) + p_θ.^2 .*s_2θ .*s_θ .*(a.^2 + r.^2 - 2*r)) ./s_θ.^2 + 16*p_r .*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4) .*(a.^2 + r.^2 - 2*r) + 16*a.^2 .*p_t .*r .*s_2θ .*(-a .*s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*c_θ .*p_r .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) .*(a.^2 + r.^2 - 2*r) + p_θ .*s_θ .*(a.^2 .*c_θ.^2 + r.^2) .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) .*(a.^2 + r.^2 - 2*r) + sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4))) - 8*a.^2 .*p_θ .*s_2θ .*(2*p_θ .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3 + s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(2*a.^3 .*p_r .*s_θ.^2 .*(-c_θ .*p_θ + p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 + 2*a .*p_r .*(a.^2 + r.^2) .*(c_θ .*p_θ - p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 - s_θ .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2)))) .*(a.^2 + r.^2 - 2*r) + 32*a .*p_ϕ .*r .*(-a .*s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*c_θ .*p_r .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) .*(a.^2 + r.^2 - 2*r) + p_θ .*s_θ .*(a.^2 .*c_θ.^2 + r.^2) .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) .*(a.^2 + r.^2 - 2*r) + sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4))) ./t_θ - 16*p_r .*r .*(2*p_θ .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3 + s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(2*a.^3 .*p_r .*s_θ.^2 .*(-c_θ .*p_θ + p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 + 2*a .*p_r .*(a.^2 + r.^2) .*(c_θ .*p_θ - p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 - s_θ .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2)))) .*(a.^2 + r.^2 - 2*r).^2 + 2*p_θ .*r .*(-8*a .*s .*ϵ .*((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)).^(3/2) .*(c_θ .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) - 2*p_r .*p_θ .*r .*s_θ.^3 .*(a.^2 + r.^2 - 2*r) + p_θ.^2 .*s_2θ .*s_θ .*(a.^2 + r.^2 - 2*r)) ./s_θ.^2 + 16*p_r .*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4) .*(a.^2 + r.^2 - 2*r) - 16*p_ϕ .*(-s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*p_ϕ .*(2*p_r .*(a.^2 + r.^2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./t_θ + p_θ .*(2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2)) + 2*p_t .*(-a.^2 .*p_r .*r .*s_2θ .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 - r.^2) .*(a.^2 .*c_θ.^2 + r.^2))) .*(a.^2 + r.^2 - 2*r) ./s_θ + 2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(2*a .*p_t .*r - p_ϕ .*(a.^2 ./t_θ.^2 + r.^2 ./s_θ.^2 - 2*r ./s_θ.^2))) .*(a.^4 .*c_θ.^4 + 2*a.^2 .*c_θ.^2 .*r.^2 + 2*a.^2 .*r .*s_θ.^2 + r.^4) ./t_θ) ./(32*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^6)

    dx[7] = -s .*ϵ .*(24*a.^2 .*c_θ .*p_r.^2 .*s_θ.^3 .*(a.^2 + r.^2) .*(a.^2 .*c_θ.^2 - 3*r.^2) .*(a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r).^2 - 24*a.^2 .*c_θ .*p_θ.^2 .*s_θ.^3 .*(a.^2 + r.^2) .*(a.^2 .*c_θ.^2 - 3*r.^2) .*(a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r) + 2*a.^2 .*p_r.^2 .*s_2θ .*s_θ.^2 .*(a.^2 .*c_θ.^2 - 3*r.^2) .*(a.^2 .*c_θ.^2 + r.^2) .*(a.^2 .*(c_2θ - 2) - r.^2) .*(a.^2 + r.^2 - 2*r).^2 + a.^2 .*p_r.^2 .*s_2θ .*s_θ.^2 .*(a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r).^2 .*(2*a.^4 .*c_θ.^2 .*(c_2θ - 2) - a.^2 .*r.^2 .*(7*c_2θ - 11) + 6*r.^4) - 8*a.^2 .*p_r .*p_θ .*r .*s_θ.^4 .*(a.^2 .*c_θ.^2 + r.^2) .*(3*a.^2 .*c_θ.^2 - r.^2) .*(a.^2 + r.^2 - 2*r) .*(3*a.^2 + 3*r.^2 - 4*r) - 8*a.^2 .*p_r .*p_θ .*r .*s_θ.^4 .*(a.^2 .*c_θ.^2 + r.^2) .*(3*a.^2 .*c_θ.^2 - r.^2) .*(a.^2 + r.^2 - 2*r) .*(3*a.^2 + 3*r.^2 - 2*r) - a.^2 .*p_θ.^2 .*s_2θ .*s_θ.^2 .*(a.^2 .*c_θ.^2 - 3*r.^2) .*(a.^2 .*c_θ.^2 + r.^2) .*(a.^2 .*(c_2θ - 5) - 4*r.^2) .*(a.^2 + r.^2 - 2*r) - a.^2 .*p_θ.^2 .*s_2θ .*s_θ.^2 .*(a.^2 + r.^2 - 2*r) .*(a.^6 .*c_θ.^4 .*(c_2θ - 5) - 4*a.^4 .*c_θ.^2 .*r.^2 .*(c_2θ - 2) + a.^2 .*r.^4 .*(c_2θ + 19) + 12*r.^6) + a .*s_2θ .*s_θ.^2 .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 - 3*r.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4)) + a .*s_2θ .*(a.^2 .*c_θ.^2 - 3*r.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4)) + 4*p_r .*p_θ .*r .*s_θ.^2 .*(-3*a.^2 .*c_θ.^2 + r.^2) .*(a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r) .*(a.^4 .*(c_2θ - 5) + a.^2 .*r.^2 .*(c_2θ - 9) + 4*a.^2 .*r .*s_θ.^2 - 4*r.^4) + 8*p_r .*p_θ .*r .*s_θ.^2 .*(-3*a.^2 .*c_θ.^2 + r.^2) .*(a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r) .*(a.^4 .*(c_2θ - 2) + a.^2 .*r.^2 .*(c_2θ - 3) + 4*a.^2 .*r .*s_θ.^2 - r.^4)) ./(8*s_θ .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)) .*(a.^2 .*c_θ.^2 + r.^2).^6) + (128*a.^3 .*c_θ .*p_t .*r .*s_θ.^3 .*(2*p_θ .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3 + s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(2*a.^3 .*p_r .*s_θ.^2 .*(-c_θ .*p_θ + p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 + 2*a .*p_r .*(a.^2 + r.^2) .*(c_θ .*p_θ - p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 - s_θ .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2)))) .*(a.^2 + r.^2 - 2*r) - 64*a .*p_r .*s_θ.^2 .*(a.^2 .*c_θ.^2 - r.^2) .*(-a .*s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*c_θ .*p_r .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) .*(a.^2 + r.^2 - 2*r) + p_θ .*s_θ .*(a.^2 .*c_θ.^2 + r.^2) .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) .*(a.^2 + r.^2 - 2*r) + sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4))) .*(a.^2 + r.^2 - 2*r) + 4*a .*p_t .*s_θ.^2 .*(-8*a .*s .*ϵ .*((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)).^(3/2) .*(c_θ .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) - 2*p_r .*p_θ .*r .*s_θ.^3 .*(a.^2 + r.^2 - 2*r) + p_θ.^2 .*s_2θ .*s_θ .*(a.^2 + r.^2 - 2*r)) ./s_θ.^2 + 16*p_r .*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4) .*(2*a.^4 .*c_θ.^2 - a.^2 .*r.^2 .*(c_2θ + 3) - 6*r.^4) - 64*a .*p_θ .*r .*s_2θ .*(a.^2 + r.^2) .*(-a .*s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*c_θ .*p_r .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) .*(a.^2 + r.^2 - 2*r) + p_θ .*s_θ .*(a.^2 .*c_θ.^2 + r.^2) .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2))) .*(a.^2 + r.^2 - 2*r) + sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(4*a .*p_ϕ .*r + p_t .*(2*a.^4 .*c_θ.^2 + a.^2 .*r.^2 .*(c_2θ + 3) + 4*a.^2 .*r .*s_θ.^2 + 2*r.^4))) + 32*p_r .*s_θ.^2 .*(-s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*p_ϕ .*(2*p_r .*(a.^2 + r.^2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./t_θ + p_θ .*(2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2)) + 2*p_t .*(-a.^2 .*p_r .*r .*s_2θ .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 - r.^2) .*(a.^2 .*c_θ.^2 + r.^2))) .*(a.^2 + r.^2 - 2*r) ./s_θ + 2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(2*a .*p_t .*r - p_ϕ .*(a.^2 ./t_θ.^2 + r.^2 ./s_θ.^2 - 2*r ./s_θ.^2))) .*(a.^2 + r.^2 - 2*r) .*(2*a.^4 .*c_θ.^4 .*r + 2*a.^4 .*c_θ.^2 .*s_θ.^2 + 4*a.^2 .*c_θ.^2 .*r.^3 - 2*a.^2 .*r.^2 .*s_θ.^2 + 2*r.^5) + 16*p_θ .*s_2θ .*(-s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(a .*p_ϕ .*(2*p_r .*(a.^2 + r.^2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2 - 2*r) ./t_θ + p_θ .*(2 - 2*r) .*(a.^2 .*c_θ.^2 + r.^2)) + 2*p_t .*(-a.^2 .*p_r .*r .*s_2θ .*(a.^2 + r.^2 - 2*r) + p_θ .*(a.^2 - r.^2) .*(a.^2 .*c_θ.^2 + r.^2))) .*(a.^2 + r.^2 - 2*r) ./s_θ + 2*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(2*a .*p_t .*r - p_ϕ .*(a.^2 ./t_θ.^2 + r.^2 ./s_θ.^2 - 2*r ./s_θ.^2))) .*(2*a.^6 .*c_θ.^4 + a.^4 .*c_θ.^2 .*r.^2 .*(c_2θ + 5) + 2*a.^4 .*r .*s_θ.^2 .*(c_2θ + 3) + 2*a.^2 .*r.^4 .*(c_2θ + 2) + 8*a.^2 .*r.^3 .*s_θ.^2 + 2*r.^6) + p_ϕ .*(-8*a .*s .*ϵ .*((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)).^(3/2) .*(c_θ .*(a .*p_t .*s_θ.^2 + p_ϕ) .*(-4*a .*p_t .*r .*s_θ.^2 + 2*p_ϕ .*(a.^2 .*c_θ.^2 + r.^2 - 2*r)) - 2*p_r .*p_θ .*r .*s_θ.^3 .*(a.^2 + r.^2 - 2*r) + p_θ.^2 .*s_2θ .*s_θ .*(a.^2 + r.^2 - 2*r)) ./s_θ.^2 + 16*p_r .*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^4) .*(8*a.^4 .*c_θ.^4 .*r + 2*a.^4 .*s_2θ.^2 + 16*a.^2 .*c_θ.^2 .*r.^3 - 4*a.^2 .*r.^2 .*(c_2θ + 3) + 8*r.^5 - 16*r.^4) + 64*p_ϕ .*(2*p_θ .*sqrt((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^3 + s .*ϵ .*sqrt((a.^2 .*c_θ.^2 + r.^2) .*(a.^2 + r.^2 - 2*r)) .*(2*a.^3 .*p_r .*s_θ.^2 .*(-c_θ .*p_θ + p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 + 2*a .*p_r .*(a.^2 + r.^2) .*(c_θ .*p_θ - p_r .*r .*s_θ) .*(a.^2 + r.^2 - 2*r).^2 - s_θ .*(a .*p_t + p_ϕ ./s_θ.^2) .*(a.^2 .*c_θ.^2 + r.^2).^2 .*(a .*p_ϕ .*(2 - 2*r) + 2*p_t .*(a.^2 - r.^2)))) .*(a.^2 + r.^2 - 2*r) .*(a.^4 .*c_θ.^4 + 2*a.^2 .*c_θ.^2 .*r.^2 + 2*a.^2 .*r .*s_θ.^2 + r.^4) ./t_θ) ./(128*((a.^2 + r.^2 - 2*r) ./(a.^2 .*c_θ.^2 + r.^2)).^(3/2) .*(a .*p_ϕ + p_t .*(a.^2 + r.^2)).^2 .*(a.^2 .*c_θ.^2 + r.^2).^7)
    return
end
